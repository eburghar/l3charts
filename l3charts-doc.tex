\documentclass{l3charts-doc}
\usepackage{l3charts}

% setup 
\hypersetup{
  keeppdfinfo,
  pdftitle={The l3charts package},
  pdfauthor={Éric BURGHARD},
  pdfcontactemail={ctan@itsufficient.me},
  pdfcontacturl={https://itsufficient.me},
  pdfsubject={Customizable charts made with TikZ and LaTeX3},
  pdfkeywords={LaTeX3, TikZ},
  pdfcopyright={\textcopyright\ 2022 Éric BURGHARD\textLF
    This work may be distributed and/or modified under the conditions
    of the LaTeX Project Public License, either version 1.3c of this
    license or (at your option) any later version.\textLF
    This work has the LPPL maintenance status `maintained'.},
  pdflicenseurl={https://www.latex-project.org/lppl/},
  pdflang={en-GB}
}

% format label white on black
\NewDocumentCommand\textinv{m}{\colorbox{black}{\textcolor{white}{#1}}}

% Start document
\RecordChanges
\PageIndex

\title{The \texttt{l3charts} package}
\author{Éric BURGHARD}
\date{2022/07/01}
\def\githuburl{https://git.itsufficient.me/latex/l3charts}

\begin{document}
\newgeometry{scale={0.8,0.9},top=4cm}% title page is centered
\maketitle
\thispagestyle{empty}
\begin{abstract}
  This package defines a few simple \TikZ{} charts that can be drawn using \LaTeX{}
  environments. This has mainly been developed as an experimentation of \texttt{expl3}
  for checking what \LaTeX3 really brought to facilitate package development (expansion
  control, clist, seq, prop, ...).
\end{abstract}
\tableofcontents
\newpage
\restoregeometry% restore default geometry

\section{About this documentation}

I doubt that \LaTeX{} will have one day a modern documentation system as powerful as \href{https://doc.rust-lang.org/cargo/commands/cargo-doc.html}{\texttt{cargo doc}} due to its
typeless and syntaxless nature. In my opinion \LaTeX{} literate programming with \pkg{docstrip}
is just an ugly hack that turns the code and the documentation unmaintainable, and it's probably
the component of \LaTeX{} which aged the most.

So I chose to write the documentation separately and borrowed much of the style from the
\href{https://github.com/schlcht/microtype}{\pkg{microtype}} package which by the way, pushes
the \pkg{docstrip} mastery to a \emph{black magic} level.

\section{Kiviat chart}

\subsection{Usage}

The \href{https://en.wikipedia.org/wiki/Radar_chart}{kiviat chart} or \emph{radar chart} allows
to represent one or several set along several dimensions.

\DescribeEnv{kiviatchart}
Environment that hold a kiviat chart. Accepts an optional argument \oarg{clist} which
is comma separated list of keywords and values :

\Describe{Option}{radius}{:dim}[3.5cm]
Maximal diagram radius

\Describe{Option}{label-radius}{:dim}[3.5cm]
Radius to put dimension labels on

\Describe{Option}{units}{:int}[5]
Set the scale of units from 0 to the given number

\Describe{Option}{*}{:keyval}
All other options are passed to \env{tikzpicture}

A \env{kiviatchart} should begin with a \env{dims}, followed by one or several \env{set}.

\subsubsection{Dimensions}

\DescribeEnv{dims}
Environment that hold the definition of all dimensions. Accepts an optional argument \oarg{clist} which
is comma separated list of keywords and values :

\Describe{Option}{dim-options}{:prop}[\{opacity=0.8\}]
\TikZ{} options for drawing dimensions axis with

\Describe{Option}{unit-options}{:prop}[\{opacity=0.3\}]
\TikZ{} options for drawing unit polygons with

\Describe{Option}{label-options}{:prop}[\{opacity=0.5,below\}]
\TikZ{} options drawing for unit labels

\Describe{Option}{label-cs}{:str}[identity]
Name of the cs used to format labels

\Describe{Option}{unit-cs}{:str}[tinytt]
Name of the cs used to format unit scale

\DescribeMacro{tinytt}
Macro used to format unit labels

\begin{minted}{latex}
\cs_new:Npn \tinytt #1 {\texttt{\tiny #1}}
\end{minted}

\DescribeMacro{value}
\cs{value}\oarg{clist}\marg{label} is used to add a dimension to the kiviat chart. \oarg{clist} is
passed to \TikZ{} to draw the nodes corresponding to the labels.

\subsubsection{Set}

\DescribeEnv{set}
\env{set} is used to add a new set to the kiviat chart. Accepts an optional argument \oarg{clist} which
is comma separated list of keywords and values :

\Describe{Option}{dot-options}{:prop}[\{fill,circle,inner~sep=1pt\}]
Options for polygon node

\Describe{Option}{*}{:keyval}[color=black,line~width=1.5pt,opacity=1,fill~opacity=0.3,fill=gray]
All other options are passed to \cs{draw} cs which draws the polygon

\DescribeMacro{value}
\cs{value}\marg{int} is used to add a value to the set.

There must be the same number of \cs{value} inside \env{set} and \env{dims}, and each \cs{value}
corresponds to the dimension in \env{dims} at the same index.

\subsection{Examples}

\subsubsection{Simple}

Use \key{label-cs} to call \cs{textinv} to format the labels.

\DescribeMacro{textinv}
Macro used to format labels

\begin{minted}{latex}
%  white text on black background
\NewDocumentCommand\textinv{m}{\colorbox{black}{\textcolor{white}{#1}}}
\end{minted}

\begin{example}
% scale is passed to tikzpicture
\begin{kiviatchart}[scale=0.75]
  % Define all the dimensions
  \begin{dims}[label-cs=textinv]
    % Specify placement of each
    % labels
    \value[above]{Dim 1}
    \value[above]{Dim 2}
    \value[left]{Dim 3}
    \value[right]{Dim 4}
    \value[right]{Dim 5}
  \end{dims}
  % Add one or several sets.
  % Each value corresponds to
  % the dimension at the same
  % index in dims
  \begin{set}
    \value{4}
    \value{3}
    \value{4}
    \value{5}
    \value{3}
  \end{set}
\end{kiviatchart}
\end{example}

\subsubsection{Multi-set}

\begin{example}
% scale is passed to tikzpicture
\begin{kiviatchart}[scale=0.75]
  \begin{dims}
    \value[above]{Dim 1}
    \value[above]{Dim 2}
    \value[left]{Dim 3}
    \value[right]{Dim 4}
    \value[right]{Dim 5}
  \end{dims}
  % Fill this set in red
  % with rectangle dots
  \begin{set}[
      fill=red,
      dot-options={
        fill,rectangle,
        inner sep=2pt
      }]
    \value{4}
    \value{3}
    \value{4}
    \value{5}
    \value{2}
  \end{set}
  % Fill this set in green
  % with diamond dots
  \begin{set}[
      fill=green,
      dot-options={
          fill,diamond,
          inner sep=2pt
      }]
    \value{2}
    \value{4}
    \value{3}
    \value{4}
    \value{5}
  \end{set}
  % Fill this set in blue
  % with semicircle dots
  \begin{set}[
      fill=blue,
      dot-options={
        fill,semicircle,
        inner sep=2pt
      }]
    \value{5}
    \value{2}
    \value{4}
    \value{3}
    \value{4}
  \end{set}
\end{kiviatchart}
\end{example}

\subsection{To do}

At the moment the environments are not user friendly. We could provide basic sanity checks,
with error messages when theses rules are violated :

\begin{itemize}
  \item one and only one \env{dims} declared before any \env{set}
  \item all \env{set} have the same number of \cs{value} than the \env{dims}
  \item \cs{value} in \env{set} is between 0 and \key{units}
\end{itemize}

\section{Ball chart}

\subsection{Usage}

\DescribeEnv{ballchart}
Environment that hold a ball chart. Accepts an optional argument \oarg{clist} which
is comma separated list of keywords and values :

\Describe{Option}{n}{:int}
The number of circles (\textbf{required})

\Describe{Option}{v-sep}{:fp}[0.1]
Vertical separator in \emph{cm}

\Describe{Option}{h-sep}{:fp}[0.5]
Horizontal separator (circle) in \emph{cm}

\Describe{Option}{radius}{:fp}[0.25]
Radius of the circles in \emph{cm}

\Describe{Option}{gap}{:fp}[0.05]
Gap between circle in \emph{cm}

\Describe{Option}{label-cs}{:str}[identity]
Macro name to format labels

\Describe{Option}{fill-options}{:prop}[\{fill=black\}]
\TikZ{} options to fill balls with

\Describe{Option}{draw-options}{:prop}[\{draw=black!30\}]
\TikZ{} options to draw balls with

\Describe{Option}{label-options}{:prop}[\{left\}]
\TikZ{} options for dimensions axis

\Describe{Option}{*}{:keyval}
All other options are passed to \env{tikzpicture}

\DescribeMacro{value}
\cs{value}\marg{label}\marg{percent} is used to add a new bar.

\subsection{Examples}

\subsubsection{Simple}

\begin{example}
% 5 circles bar, hide the circles
\begin{ballchart}[
    n=5,
    draw-options={draw=none}]
  \value{Dim 1}{95}
  \value{Dim 2}{80}
  \value{Dim 3}{80}
  \value{Dim 4}{20}
\end{ballchart}
\end{example}

\subsubsection{Delimited}

\begin{example}
% 6 circles bar, format the labels,
% fill in red, and shows circles
\begin{ballchart}[
    n=6,
    label-cs=textinv,
    v-sep=0.2,
    fill-options={fill=red!50},
    draw-options={draw=black}]
  \value{Dim 1}{95}
  \value{Dim 2}{80}
  \value{Dim 3}{80}
  \value{Dim 4}{20}
\end{ballchart}
\end{example}

\section{Bar chart}

\subsection{Usage}

\DescribeEnv{barchart}
Environment that hold a bar chart. Accepts an optional argument \oarg{clist} which
is comma separated list of keywords and values :

\Describe{Option}{width}{:fp}
Maximum width (\textbf{required}) in \emph{cm}

\Describe{Option}{height}{:fp}[0.35]
Bar height in \emph{cm}

\Describe{Option}{gap}{:fp}[0.25]
Gap in \emph{cm}

\Describe{Option}{fill-options}{:prop}[\{fill=black\}]
\TikZ{} options to fill the bar with

\Describe{Option}{draw-options}{:prop}[\{draw=black!20\}]
\TikZ{} options to draw the bar with

\Describe{Option}{label-cs}{:prop}[identity]
Macro name to format labels

\Describe{Option}{*}{:keyval}
All other options are passed to \env{tikzpicture}

\DescribeMacro{value}
\cs{value}\marg{label}\marg{percent} is used to add a new bar.

\subsection{Examples}

\subsubsection{Simple}

\begin{example}
% hide borders
\begin{barchart}[
    width=3,
    draw-options={draw=none}]
  \value{Dim 1}{60}
  \value{Dim 2}{100}
  \value{Dim 3}{70}
  \value{Dim 4}{70}
  \value{Dim 5}{40}
  \value{Dim 6}{60}
\end{barchart}
\end{example}

\subsubsection{Delimited}

\begin{example}
% 3cm wide bars, format labels,
% fill in red and show borders 
\begin{barchart}[
    width=3,
    label-cs=textinv,
    fill-options={fill=red!50},
    draw-options={draw=red!50}]
  \value{Dim 1}{60}
  \value{Dim 2}{100}
  \value{Dim 3}{70}
  \value{Dim 4}{70}
  \value{Dim 5}{40}
  \value{Dim 6}{60}
\end{barchart}
\end{example}

\section{Bubble chart}

\subsection{Usage}

\DescribeEnv{bubblechart}
Environment that hold a bubble chart. Accepts an optional argument \oarg{clist} which
is comma separated list of keywords and values :

\Describe{Option}{radius}{:fp}[1]
Max radius in \emph{cm}

\Describe{Option}{gap}{:fp}[0.3]
Gap between bubbles in \emph{cm}

\Describe{Option}{fill-options}{:prop}[\{fill=black\}]
\TikZ{} options to fill bubble with

\Describe{Option}{draw-options}{:prop}[\{draw=black!30\}]
\TikZ{} options to draw bubble with

\Describe{Option}{label-cs}{:str}[identity]
Macro name to format labels

\Describe{Option}{*}{:keyval}
All other options are passed to \env{tikzpicture}

\DescribeMacro{value}
\cs{value}\marg{label}\marg{percent} is used to add a new bubble.

\subsection{Examples}

\subsubsection{Simple}

\begin{example}
% hide borders
\begin{bubblechart}[
    draw-options={draw=none}]
  \value{Dim 1}{80}
  \value{Dim 2}{90}
  \value{Dim 3}{50}
\end{bubblechart}
\end{example}

\subsubsection{Delimited}

\begin{example}
% Format labels, fill in red,
% and show maximum dashed
\begin{bubblechart}[
    label-cs=textinv,
    fill-options={fill=red!50},
    draw-options={draw=red!50,dashed}]
  \value{Dim 1}{80}
  \value{Dim 2}{90}
  \value{Dim 3}{50}
\end{bubblechart}
\end{example}

% \newpage
\PrintIndex

\section{Changes}

\begin{History}

\Version{0.2.0}{2022/07/04}
\item define a document class borrowed from \href{https://github.com/schlcht/microtype}{\pkg{microtype}}

\Version{0.1.0}{2022/07/01}
\item Initial version

\end{History}

\end{document}
